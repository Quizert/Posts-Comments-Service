# Posts-Comments-Service

Реализована система для добавления и чтения постов и комментариев с использованием GraphQL, аналогичную комментариям к постам на популярных платформах, таких как Хабр или Reddit.

## Описание
### Характеристики системы постов:
*	Можно просмотреть список постов.
*	Можно просмотреть пост и комментарии под ним.
*	Пользователь, написавший пост, может запретить оставление комментариев к своему посту.

### Характеристики системы комментариев к постам:
*	Комментарии организованы иерархически, позволяя вложенность без ограничений.
*	Длина текста комментария ограничена до, например, 2000 символов.
*	Система пагинации для получения списка комментариев.

### Дополнительное требование
Реализована подписка на новые комментарии для постов в реальном времени через WebSocket с использованием GraphQL Subscriptions.
### Запуск приложения 
```
docker-compose up --build
```
Все необходимые миграции сами накатятся. Автоматически создаются три пользователя в таблице users.

Параметры приложения находятся в .env
### Выбор хранилища
Хранилище определяется задаваемым параметром в .env.

Postgres хранилище
```
STORAGE_MODE='postgres'
```

In-memory хранилище

```
STORAGE_MODE='memory'
```

## Небольшие детали реализации
* Был создан собственный обработчик ошибок, который на основе кастомных ошибок возвращает *gqlerror.Error с нужной информацией;
* Написаны unit тесты;
* Интерфейсы определяются там, где они используются, а не реализуются;
* Для решения n+1 проблемы были написаны собственные резолверы для полей (comments, replies), чтобы использовать их только по мере необходимости;
* Layout запроса логируются при помощи zap.

### Пример запроса на получение всех постов с комментариями:
```graphql
query {
  GetAllPosts {
    title
    author{
      id
      username
    }
    createdAt
    comments {
      id
      payload
      replies {
        id
        payload
        replies {
          id
          payload
        }
      }
    }
  }
}
```
